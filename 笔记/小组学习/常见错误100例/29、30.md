# 数据和代码：数据就是数据，代码就是代码

- SQL 注入

  ```tex
  客户端提供给服务端的查询值，是一个数据，会成为 SQL 查询的一部分。黑客通过修改这个值注入一些 SQL，来达到在服务端运行 SQL 的目的，相当于把查询条件的数据变为了查询代码。这种攻击方式，叫做 SQL 注入。
  ```

- 代码注入

  ```tex
  对于规则引擎，我们可能会用动态语言做一些计算，和 SQL 注入一样外部传入的数据只能当做数据使用，如果被黑客利用传入了代码，那么代码可能就会被动态执行。这种攻击方式，叫做代码注入
  ```

- XSS（跨站脚本）攻击

  ```
  对于用户注册、留言评论等功能，服务端会从客户端收集一些信息，本来用户名、邮箱这类信息是纯文本信息，但是黑客把信息替换为了 JavaScript 代码。那么，这些信息在页面呈现时，可能就相当于执行了 JavaScript 代码。甚至是，服务端可能把这样的代码，当作普通信息保存到了数据库。黑客通过构建 JavaScript 代码来实现修改页面呈现、盗取信息，甚至蠕虫攻击的方式，叫做 XSS（跨站脚本）攻击。
  ```

## SQL注入能干的事情比你想象的更多

- sql注入认知上的误区

  ```
  第一，认为 SQL 注入问题只可能发生于 Http Get 请求，也就是通过 URL 传入的参数才可能产生注入点;
  第二，认为不返回数据的接口，不可能存在注入问题;
  第三，认为 SQL 注入的影响范围，只是通过短路实现突破登录，只需要登录操作加强防范即可;
  ```

- 注入方式

  - 报错注入
  - 基于时间的盲注

- 在 SQL 语句中使用“?”作为参数占位符，然后提供参数值

- MyBatis 

  ```
  在 MyBatis 中，“#{}”是参数化的方式，“${}”只是占位符替换
  ```

## 小心动态执行代码时代码注入漏洞

- 服务端对客户端传入数据不加判断直接执行
- 解决方式；
  - 类似sql注入：把外部传入的条件数据仅仅当做数据来对待

## XSS必须全方位严防死堵

- 对前端入参进行转义
- 对于cookie中的敏感数据开启httponly属性



# 如何正确保存和传输敏感数据

## 应该怎样保存用户密码？

### 关于md5
- 仅仅使用 MD5 对密码进行摘要，并不安全；可以通过字典表
- 不能在代码中写死盐，且盐需要有一定的长度，最好是每一个密码都有独立的盐，并且盐要长一点，比如超过 20 位
- 不建议将用户信息作为盐，最好是随机的值，并且是全球唯一的，意味着全球不可能有现成的彩虹表给你用

### BCryptPasswordEncoder

- 使用不需要传入盐
- 代价因子的值越大，BCrypt 哈希的耗时越久。因此，对于代价因子的值，更建议的实践是，根据用户的忍耐程度和硬件，设置一个尽可能大的值



## 应该怎么保存姓名和身份证？

- 在业务代码中要避免使用 DES 加密

- AES 是当前公认的比较安全，兼顾性能的对称加密算法；严格来说，AES 并不是实际的算法名称，而是算法标准

  - ECB 模式虽然简单，但是不安全，不推荐使用；-- 两个相同明文分组产生的密文，就是两个相同的密文分组叠在一起

    <img src="/Users/souche/Library/Mobile Documents/com~apple~CloudDocs/工作区/md_include_image/image-20200914165007334.png" alt="image-20200914165007334" style="zoom:50%;" />

  - CBC 模式

    ```
    在解密或解密之前引入了 XOR 运算，第一个分组使用外部提供的初始化向量IV，从第二个分组开始使用前一个分组的数据，这样即使明文是一样的，加密后的密文也是不同的，并且分组的顺序不能任意调换。这就解决了 ECB 模式的缺陷：
    ```

    <img src="/Users/souche/Library/Mobile Documents/com~apple~CloudDocs/工作区/md_include_image/image-20200914164944589.png" alt="image-20200914164944589" style="zoom:50%;" />

    ​	

  - 对于敏感数据保存，除了选择 AES+ 合适模式进行加密外推荐以下几个实践

    - 不要在代码中写死一个固定的密钥和初始化向量，最好和之前提到的盐一样，是唯一、独立并且每次都变化的。
    - 推荐使用独立的加密服务来管控密钥、做加密操作，千万不要把密钥和密文存在一个数据库，加密服务需要设置非常高的管控标准
    - 数据库中不能保存明文的敏感信息，但可以保存脱敏的信息。普通查询的时候，直接查脱敏信息即可

    ```
    实践流程：
    第一步，对于用户姓名和身份证，我们分别保存三个信息，脱敏后的明文、密文和加密ID。加密服务加密后返回密文和加密 ID，随后使用加密 ID 来请求加密服务进行解密：
    第二步，加密服务数据表保存加密 ID、初始化向量和密钥。加密服务表中没有密文，实现了密文和密钥分离保存：
    第三步，加密服务使用 GCM 模式（ Galois/Counter Mode）的 AES-256 对称加密算法，也就是 AES-256-GCM；
    第四步，分别实现加密和解密接口用于测试
    ```

    

## 用一张图说清楚HTTPS

 HTTPS=SSL/TLS+HTTP，通过使用一系列加密算法来确保信息安全传输，以实现数据传输的机密性、完整性和权威性

机密性：使用非对称加密来加密密钥，然后使用密钥来加密数据，既安全又解决了非对

称加密大量数据慢的问题。你可以做一个实验来测试两者的差距。

完整性：使用散列算法对信息进行摘要，确保信息完整无法被中间人篡改。

权威性：使用数字证书，来确保我们是在和合法的服务端通信。

![https](/Users/souche/Library/Mobile Documents/com~apple~CloudDocs/工作区/md_include_image/https.png)